/* === Chatbot Plugin: ChatGPT-Look & Förderverband-Branding (Dark) === */
:root {
  --dual-chatbot-primary: #4e8cff;
  --dual-chatbot-secondary: #f5f6fa;
  --dual-chatbot-bot-bg: #f0f4fb;
  --dual-chatbot-user-bg: #e1f5e6;
  --dual-chatbot-text: #222;
  --dual-chatbot-text-muted: #888;
  --dual-chatbot-sidebar-bg: #222a38;
  --dual-chatbot-sidebar-text: #fff;
  --dual-chatbot-main-bg: #fff;
  --dual-chatbot-new-chat-btn-bg: #e8eaf6;
  --dual-chatbot-mini-width: 360px;
  --dual-chatbot-mini-height: 520px;
  --dual-chatbot-sidebar-width-desktop: 300px;
  /* Centered conversation column width (ChatGPT-like) */
  /* Responsive: max 760px, otherwise ~92vw on small screens */
  --dual-chatbot-chat-width: min(760px, 92vw);
  /* ChatGPT-like user bubble colors */
  /* Bubble color follows the sidebar's primary accent */
  --dual-chatbot-user-bubble-bg: var(--dual-chatbot-primary);
  --dual-chatbot-user-bubble-text: #ffffff;
  /* Max width of the user bubble relative to the chat column */
  --dual-chatbot-user-bubble-max: 70%;
  /* Modern scrollbar tokens (light defaults) */
  --dual-chatbot-scrollbar-track: rgba(0,0,0,.06);
  --dual-chatbot-scrollbar-thumb: rgba(90,105,135,.38);
  --dual-chatbot-scrollbar-thumb-hover: rgba(90,105,135,.55);

  --dual-chatbot-sidebar-toggle-icon-color: #fff;
  /* Vector icons for message actions (CSS masks) */
  --dual-icon-copy: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M16 1H6C4.34 1 3 2.34 3 4v10h2V4c0-1.1.9-2 2-2h9V1zm3 4H9c-1.66 0-3 1.34-3 3v11c0 1.66 1.34 3 3 3h10c1.66 0 3-1.34 3-3V8c0-1.66-1.34-3-3-3zm1 14c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v11z"/></svg>');
  /* Modern refresh/regenerate (rounded outline) */
  --dual-icon-regen: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="%23000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/><path d="M20.49 15A9 9 0 0 1 5.64 18.36L1 14"/></g></svg>');
  --dual-icon-edit: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 000-1.42l-2.34-2.34a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/></svg>');
  --dual-icon-del: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M6 19c0 1.1.9 2 2 2h8a2 2 0 002-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>');
  --dual-icon-search: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="%23000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></g></svg>');
  /* Modern rounded outline thumbs (Feather-style, round caps/joins) */
  --dual-icon-up: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="none" stroke="%23000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>');
  --dual-icon-down: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="none" stroke="%23000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/></svg>');
}

/* A11y: global focus variable */
:root { --dcb-focus: var(--dual-chatbot-primary, #3b82f6); }

/* Globale, einheitliche Fokusdarstellung */
button:focus-visible,
[role="button"]:focus-visible,
a:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[tabindex]:focus-visible,
.dual-chatbot-send:focus-visible,
.dual-chatbot-microphone:focus-visible,
.dual-chatbot-sidebar-toggle:focus-visible,
.dual-chatbot-menu-trigger:focus-visible,
.dual-chatbot-chip[tabindex]:focus-visible,
.dual-chatbot-list-item[tabindex]:focus-visible {
  outline: 2px solid var(--dcb-focus);
  outline-offset: 2px;
}

/* Chat-Input & primäre Controls dürfen einen Tick prominenter sein */
.dual-chatbot-input:focus-visible,
.dual-chatbot-send:focus-visible,
.dual-chatbot-sidebar-toggle:focus-visible {
  outline-width: 3px;
}

/* Fallbacks & Barrierefreiheits-Edgecases */
@media (prefers-contrast: more) {
  button:focus-visible,
  [role="button"]:focus-visible,
  a:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible,
  [tabindex]:focus-visible {
    outline-width: 3px;
  }
}

/* Windows High Contrast / Forced Colors */
@media (forced-colors: active) {
  button:focus-visible,
  [role="button"]:focus-visible,
  a:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible,
  [tabindex]:focus-visible {
    outline: 2px solid CanvasText;
  }
}

/* Safari/ältere Browser – Klick ohne Tastatur soll Ring unterdrücken */
:focus:not(:focus-visible) { outline: none; }

/* Fokus innerhalb Wrapper sichtbar halten (z. B. Input mit eingebautem Icon/Button) */
.dual-chatbot-input-wrapper:focus-within {
  outline: 2px solid var(--dcb-focus);
  outline-offset: 2px;
  border-radius: 8px;
}

/* When fullscreen chatbot is open, prevent page from scrolling (single scrollbar) */
html.dual-chatbot-modal-open, body.dual-chatbot-modal-open { overflow: hidden !important; height: 100%; }

/* === Modern, subtle scrollbars (scoped to chatbot areas) === */
.dual-chatbot-main-chat,
.dual-chatbot-sidebar-list {
  /* Firefox */
  scrollbar-width: thin;
  scrollbar-color: var(--dual-chatbot-scrollbar-thumb) transparent;
}

/* WebKit-based browsers */
.dual-chatbot-main-chat::-webkit-scrollbar,
.dual-chatbot-sidebar-list::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
.dual-chatbot-main-chat::-webkit-scrollbar-track,
.dual-chatbot-sidebar-list::-webkit-scrollbar-track {
  background: transparent; /* let container bg shine through */
}
.dual-chatbot-main-chat::-webkit-scrollbar-thumb,
.dual-chatbot-sidebar-list::-webkit-scrollbar-thumb {
  background-color: var(--dual-chatbot-scrollbar-thumb);
  border-radius: 999px;
  border: 3px solid transparent; /* creates slim pill */
  background-clip: content-box;
}
.dual-chatbot-main-chat::-webkit-scrollbar-thumb:hover,
.dual-chatbot-sidebar-list::-webkit-scrollbar-thumb:hover {
  background-color: var(--dual-chatbot-scrollbar-thumb-hover);
}
.dual-chatbot-main-chat::-webkit-scrollbar-corner,
.dual-chatbot-sidebar-list::-webkit-scrollbar-corner { background: transparent; }

/* ===== Fullscreen Advisor Chatbot ===== */
.dual-chatbot-fullscreen {
  position: fixed;
  z-index: 999999;
  top: 0; left: 0; right: 0; bottom: 0;
  display: flex;
  --sidebar-width: 290px;
  background: var(--dual-chatbot-main-bg, #fff);
  font-family: 'Inter', Arial, sans-serif;
  box-shadow: 0 6px 32px rgba(40,60,100,.20);
  transition: transform .25s ease, opacity .25s ease;
}

/* ===== Sidebar / Sessions ===== */
.dual-chatbot-sidebar {
  width: var(--sidebar-width, 290px);
  flex: 0 0 var(--sidebar-width, 290px); /* fixed width: don't shrink/grow */
  min-width: var(--sidebar-width, 290px);
  position: relative;
  background: var(--dual-chatbot-sidebar-bg, #202738);
  color: var(--dual-chatbot-sidebar-text, #fff);
  display: flex;
  flex-direction: column;
  padding: 0;
  border-right: 1.5px solid #eaeaea;
}

.dual-chatbot-sidebar-header {
  font-weight: 600;
  font-size: 1.12rem;
  padding: 16px 20px 12px 24px;
  letter-spacing: .01em;
  border-bottom: 1px solid #29324a;
  background: rgba(255,255,255,0.05);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.dual-chatbot-profile {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 20px 24px 16px 24px;
  border-bottom: 1px solid #27314a;
  cursor: pointer;
  background: transparent;
  text-decoration: none;            /* if rendered as <a> */
  color: var(--dual-chatbot-sidebar-text, #fff);
}
.dual-chatbot-profile img {
  width: 38px; height: 38px;
  border-radius: 50%;
  object-fit: cover;
  background: #fff;
  border: 1.5px solid #b2c1e6;
}
.dual-chatbot-profile span {
  font-weight: 600;
  font-size: 1.02rem;
  color: var(--dual-chatbot-sidebar-text, #fff);
}

.dual-chatbot-sidebar-list {
  list-style: none;
  margin: 0; padding: 0;
  flex: 1 1 auto;
  overflow-y: auto;
  overflow-x: hidden;
}

.dual-chatbot-session-item {
  display: flex;
  align-items: center;
  padding: 12px 24px 12px 24px;
  cursor: pointer;
  border-bottom: 1px solid #212840;
  transition: background .17s;
}
.dual-chatbot-session-item.active, .dual-chatbot-session-item:hover {
  background: #324063;
}
.dual-chatbot-session-title {
  flex: 1 1 auto;
  font-size: 1rem;
  color: var(--dual-chatbot-sidebar-text, #fff);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.dual-chatbot-rename-input {
  flex: 1 1 auto;
  font-size: 1rem;
  padding: 4px 8px;
  border: 1.5px solid #b4c8ff;
  border-radius: 7px;
}

.dual-chatbot-delete-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px; height: 28px;
  padding: 0; border: none;
  background: transparent;
  color: var(--dcb-fg, #bbcedf);
  border-radius: 6px;
  cursor: pointer;
  margin-left: 7px;
  transition: background .15s ease;
}
.dual-chatbot-delete-btn::before {
  content: '';
  width: 22px; height: 22px;
  display: block;
  background-color: currentColor;
  -webkit-mask: var(--dual-icon-del) no-repeat center / contain;
  mask: var(--dual-icon-del) no-repeat center / contain;
}
.dual-chatbot-delete-btn:hover { background: rgba(0,0,0,.06); color: #fff; }

/* Minimal styles for the rename (edit) icon-only button */
.dual-chatbot-rename-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px; height: 28px;
  padding: 0; border: none;
  background: transparent;
  color: var(--dcb-fg, #ffffff);
  border-radius: 6px;
  cursor: pointer;
}
.dual-chatbot-rename-btn:hover { background: rgba(0,0,0,.06); }
.dual-chatbot-rename-btn:focus-visible {
  outline: 2px solid #6366f1; outline-offset: 2px;
}
/* Rename mask icon */
.dual-chatbot-rename-btn .dual-chatbot-icon-mask{
  width: 22px; height: 22px;
  -webkit-mask-image: var(--dual-icon-edit);
  mask-image: var(--dual-icon-edit);
}

/* During inline rename, hide action buttons so input can take full width */
.dual-chatbot-session-item.is-renaming .dual-chatbot-rename-btn,
.dual-chatbot-session-item.is-renaming .dual-chatbot-delete-btn {
  display: none;
}

/* Sidebar toggle: use mask icons instead of inline SVG */
.dual-chatbot-sidebar-toggle-icon .dual-chatbot-icon-mask{
  width: 20px; height: 20px;
  -webkit-mask-image: var(--dual-chatbot-collapse-icon);
  mask-image: var(--dual-chatbot-collapse-icon);
}
.dual-chatbot-sidebar-toggle.is-collapsed .dual-chatbot-sidebar-toggle-icon .dual-chatbot-icon-mask{
  -webkit-mask-image: var(--dual-chatbot-expand-icon);
  mask-image: var(--dual-chatbot-expand-icon);
}
/* Stop flipping when using separate expand icon */
.dual-chatbot-sidebar-toggle.is-collapsed .dual-chatbot-sidebar-toggle-icon{ transform: none; }

.dual-chatbot-new-chat-btn {
  margin: 16px 16px 10px 16px;
  background: var(--dual-primary, #4e8cff);
  color: var(--dual-bg, #fff);
  border: none;
  border-radius: 10px;
  padding: 8px 18px;
  font-size: .97rem;
  font-weight: 600;
  cursor: pointer;
  transition: background .15s;
}
.dual-chatbot-new-chat-btn:hover { filter: brightness(0.92); }

/* ===== Main Advisor Area ===== */
.dual-chatbot-main {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  min-width: 0; /* allow main to shrink instead of sidebar */
  background: var(--dual-chatbot-main-bg, #fff);
}

.dual-chatbot-main-header {
  position: sticky;
  top: 0;
  z-index: 11;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: .5rem;
  font-size: 1.09rem;
  font-weight: 600;
  padding: 18px 22px 14px 32px;
  background: var(--dual-chatbot-secondary, #f4f6fa);
  border-bottom: 1.5px solid #eaeaea;
  letter-spacing: .01em;
}

/* Keep toggle and title together on the left */
.dual-chatbot-main-header .dcb-left {
  display: flex;
  align-items: center;
  gap: .5rem;
}

/* Reset default margins on the title */
.dual-chatbot-header-title {
  margin: 0;
}

/* Sidebar toggle positioned in sidebar header (ChatGPT-style) */
.dual-chatbot-sidebar-header .dual-chatbot-sidebar-toggle {
  position: static;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  margin: 0;
  border-radius: 8px;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.15);
  color: var(--dual-chatbot-sidebar-toggle-icon-color, #fff);
  cursor: pointer;
  box-shadow: 0 1px 3px rgba(0,0,0,.2);
  transition: background .2s ease, box-shadow .2s ease, transform .2s ease;
  z-index: 12;
}

.dual-chatbot-sidebar-header .dual-chatbot-sidebar-toggle:hover {
  background: rgba(255,255,255,0.15);
  box-shadow: 0 2px 6px rgba(0,0,0,.3);
}

.dual-chatbot-controls button {
  background: none;
  border: none;
  color: var(--dual-chatbot-text-muted, #888);
  font-size: 1.26rem;
  margin-left: 10px;
  cursor: pointer;
  border-radius: 7px;
  transition: background .15s;
}
.dual-chatbot-controls button:hover { background: #e9eefa; color: var(--dual-chatbot-primary); }

/* Minimized state: show only header area of fullscreen view */
/* (Removed global minimize of fullscreen) */

.dual-chatbot-main-chat {
  flex: 1 1 auto;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 28px 28px 12px 32px;
  background: var(--dual-chatbot-main-bg, #fff);
  /* Center a single column like ChatGPT */
  display: grid;
  grid-template-columns: minmax(0, var(--dual-chatbot-chat-width));
  justify-content: center;
  align-content: start; /* prevent rows stretching to container height */
  align-items: start;   /* ensure items size to content */
  grid-auto-rows: max-content; /* each row wraps its content height */
  overscroll-behavior: contain; /* don't bubble scroll to page */
}

/* Hide scrollbar when there are no messages */
.dual-chatbot-main-chat:empty {
  overflow: hidden;
}

/* Base message: no bubble by default; alignment handled per-sender */
.dual-chatbot-message {
  margin-bottom: 14px;
  max-width: 100%;
  font-size: 1.04rem;
  line-height: 1.5;
  word-break: break-word;
  overflow-wrap: anywhere; /* ensure long unbroken strings wrap */
  /* Preserve spaces from streamed chunks; keep line breaks */
  white-space: pre-wrap;
  box-shadow: none;
}
/* Typing indicator message (no bubble, centered in flow without layout shifts) */
.dual-chatbot-typing { background: transparent; padding: 0; }
.dual-typing { display: inline-flex; align-items: center; gap: 6px; height: 22px; min-width: 48px; }
.dual-typing-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: .35; transform: scale(.66); animation: dual-typing-wave 1.2s ease-in-out infinite; }
.dual-typing-dot:nth-child(2) { animation-delay: .15s; }
.dual-typing-dot:nth-child(3) { animation-delay: .30s; }
@keyframes dual-typing-wave { 0%, 80%, 100% { opacity:.35; transform: scale(.66); } 40% { opacity:1; transform: scale(1); } }
@media (prefers-reduced-motion: reduce) { .dual-typing-dot { animation-duration: 2.0s; opacity: .55; } }
/* User: speech bubble on the right */
/* Place user bubble inside so actions can sit outside below */
.dual-chatbot-user { justify-self: end; align-self: start; display: grid; }
.dual-chatbot-user .dual-chatbot-bubble {
  background: var(--dual-chatbot-user-bubble-bg);
  color: var(--dual-chatbot-user-bubble-text, #fff);
  padding: 10px 14px;
  border-radius: 16px;
  box-shadow: 0 2px 7px rgba(70, 120, 190, .10);
  display: inline-block;
  width: -moz-fit-content; width: fit-content;
  max-width: min(100%, var(--dual-chatbot-user-bubble-max));
  justify-self: end;
}
/* Bot: plain text on the left, no bubble background */
.dual-chatbot-bot {
  justify-self: start;
  align-self: start;
  background: transparent;
  color: var(--dual-chatbot-text, #15315a);
  padding: 0;
  border-radius: 0;
  box-shadow: none;
  display: block; /* take the full column width like ChatGPT */
  width: 100%;
  max-width: 100%;
}

/* Streaming typing indicator */
/* Hide typing cursor (ChatGPT-style minimal) */
.dual-chatbot-message.is-typing::after{ content: none !important; display:none !important; animation:none !important; }
@keyframes dual-blink { 50% { opacity: .1; } }

/* Message actions */
.dual-msg-actions{ display:flex; gap:6px; opacity:1; transition:opacity .15s ease; margin-top:6px; }
.dual-chatbot-bot .dual-msg-actions{ justify-self: start; }
.dual-chatbot-user .dual-msg-actions{ justify-self: end; }
.dual-msg-actions .dual-msg-btn{ position:relative; width:28px; height:28px; border:none; background:transparent; color:inherit; display:inline-flex; align-items:center; justify-content:center; border-radius:8px; cursor:pointer; line-height:1; opacity:.85; }
.dual-msg-actions .dual-msg-btn::before{ content:''; width:16px; height:16px; background-color: currentColor; -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat:no-repeat; mask-repeat:no-repeat; -webkit-mask-position:center; mask-position:center; }
.dual-msg-btn.icon-copy::before{ -webkit-mask-image: var(--dual-icon-copy); mask-image: var(--dual-icon-copy); }
.dual-msg-btn.icon-regen::before{ -webkit-mask-image: var(--dual-icon-regen); mask-image: var(--dual-icon-regen); }
.dual-msg-btn.icon-edit::before{ -webkit-mask-image: var(--dual-icon-edit); mask-image: var(--dual-icon-edit); }
.dual-msg-btn.icon-del::before{ -webkit-mask-image: var(--dual-icon-del); mask-image: var(--dual-icon-del); }
.dual-msg-btn.icon-up::before{ -webkit-mask-image: var(--dual-icon-up); mask-image: var(--dual-icon-up); }
.dual-msg-btn.icon-down::before{ -webkit-mask-image: var(--dual-icon-down); mask-image: var(--dual-icon-down); }
.dual-msg-actions .dual-msg-btn:hover{ background: rgba(0,0,0,.06); opacity:1; }
body.dual-chatbot-theme-dark .dual-msg-actions .dual-msg-btn:hover{ background: rgba(255,255,255,.08); }
/* icon color per theme */
body.dual-chatbot-theme-light .dual-msg-actions .dual-msg-btn{ color:#000; }
body.dual-chatbot-theme-dark .dual-msg-actions .dual-msg-btn{ color:#fff; }

/* tooltips on action buttons */
.dual-msg-actions .dual-msg-btn[data-tip]:hover::after{
  content: attr(data-tip);
  position:absolute; top: calc(100% + 6px); left:50%; transform:translateX(-50%);
  background: rgba(0,0,0,.8); color:#fff; padding:4px 6px; border-radius:6px; font-size:.75rem; white-space:nowrap; pointer-events:none;
}
body.dual-chatbot-theme-dark .dual-msg-actions .dual-msg-btn[data-tip]:hover::after{ background: rgba(255,255,255,.12); color:#fff; }

/* Code block UI */
.dual-codeblock{ position:relative; padding-top:28px; }
.dual-codeblock .dual-code-copy{ position:absolute; top:4px; right:6px; border:none; background: rgba(0,0,0,.06); color:inherit; width:28px; height:24px; border-radius:6px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; }
.dual-codeblock .dual-code-copy::before{ content:''; width:16px; height:16px; background-color: currentColor; -webkit-mask-image: var(--dual-icon-copy); mask-image: var(--dual-icon-copy); -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat:no-repeat; mask-repeat:no-repeat; -webkit-mask-position:center; mask-position:center; }
.dual-codeblock .dual-code-copy[data-tip]:hover::after{ content: attr(data-tip); position:absolute; top: calc(100% + 6px); right:0; background: rgba(0,0,0,.8); color:#fff; padding:3px 6px; border-radius:6px; font-size:.72rem; white-space:nowrap; }
body.dual-chatbot-theme-dark .dual-codeblock .dual-code-copy[data-tip]:hover::after{ background: rgba(255,255,255,.12); }
body.dual-chatbot-theme-dark .dual-codeblock .dual-code-copy{ background: rgba(255,255,255,.10); }
.dual-codeblock .dual-code-copy{ color: inherit; }
body.dual-chatbot-theme-light .dual-codeblock .dual-code-copy{ color:#000; }
body.dual-chatbot-theme-dark .dual-codeblock .dual-code-copy{ color:#fff; }
.dual-codeblock .dual-code-copy:hover{ filter:brightness(.95); }
.dual-codeblock .dual-code-lang{ position:absolute; top:4px; left:8px; font-size:.78rem; opacity:.8; }

/* subtle hover highlight for entire message */
.dual-chatbot-message{ transition: background .12s ease, box-shadow .12s ease; border-radius:12px; display:grid; grid-auto-rows:max-content; }
/* Disable hover background on messages for a cleaner look */
.dual-chatbot-bot:hover{ background: transparent; }
body.dual-chatbot-theme-dark .dual-chatbot-bot:hover{ background: transparent; }
.dual-chatbot-user:hover{ filter: none; }

/* Edit textarea */
.dual-edit-text{ width:100%; min-height:64px; padding:8px; border-radius:8px; border:1px solid rgba(0,0,0,.15); background:transparent; color:inherit; }
body.dual-chatbot-theme-dark .dual-edit-text{ border-color: rgba(255,255,255,.2); }

/* Footer-Layout fixieren */
.dual-chatbot-main-footer {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;
  padding-bottom: calc(12px + env(safe-area-inset-bottom));
  box-sizing: border-box;
  background: var(--dual-chatbot-secondary, #f8fafc);
  border-top: 1.5px solid #eaeaea;
  justify-content: center; /* center input to match chat width */
}

.dual-chatbot-input {
  display: block;
  width: 100%;
  height: 44px;
  min-height: 44px;
  max-height: 160px;        /* für optionales Auto-Grow */
  line-height: 22px;
  padding: 10px 14px;
  border: 1px solid #e1e4e8; /* konstante Breite! */
  border-radius: 10px;
  box-sizing: border-box;
  resize: none;              /* User-Resize aus */
  overflow-y: hidden;        /* Scrollbar standardmäßig aus */
  -ms-overflow-style: none;  /* IE/Edge */
  scrollbar-width: none;     /* Firefox */
}
.dual-chatbot-input::-webkit-scrollbar { display: none; } /* WebKit */
.dual-chatbot-input:focus {
  outline: 2px solid var(--dual-chatbot-primary);
  outline-offset: 0;
  border-color: var(--dual-chatbot-primary);     /* nur Farbe ändern, nicht Breite */
}
/* Wrapper für Mic + Textarea */
.dual-chatbot-input-wrapper {
  display: flex;
  align-items: center;   /* sorgt dafür, dass Input und Icon mittig ausgerichtet sind */
  flex: 0 0 auto; /* do not stretch to full width */
  gap: 10px;
  min-width: 0; /* wichtig für korrektes Shrinken der Textarea */
  min-height: 48px; /* wie bisher, falls gesetzt */
  width: 100%;
  max-width: var(--dual-chatbot-chat-width);
  margin: 0 auto; /* zentriert die Eingabezeile */
}

/* Gemeinsamer Icon-Button */
.dual-chatbot-icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border: none;
  padding: 0;
  background: transparent;
  cursor: pointer;
  transition: box-shadow 0.15s, transform 120ms ease, opacity 120ms ease;
}
.dual-chatbot-icon-btn img {
  width: 22px;
  height: 22px;
  display: block;
  pointer-events: none;
}

.dual-chatbot-icon-btn:hover,
.dual-chatbot-icon-btn:focus-visible {
  box-shadow: 0 0 6px color-mix(in srgb, var(--dual-chatbot-primary) 35%, transparent);
}

.dual-chatbot-icon-btn:focus-visible {
  outline: 2px solid var(--dcb-focus);
  outline-offset: 2px;
}


/* Senden-Button: fester Frame, kein Hover-Reflow */
.dual-chatbot-send {
  touch-action: manipulation;

  /* Animation ohne Reflow */
  transition: transform 120ms ease, opacity 120ms ease;
  will-change: transform;

  /* jegliche Hover-Hintergründe aushebeln */
  box-shadow: none !important;
  margin: 0;
}

/* Kein visueller Hover (neutral) */
.dual-chatbot-send:hover {
  background: transparent !important;
  box-shadow: none !important;
  opacity: 1;
}

/* Klickgefühl beim Drücken (Maus/Tap) */
.dual-chatbot-send:active {
  transform: scale(0.96);
}

/* Während „Senden“ läuft (per JS gesetzt) */
.dual-chatbot-send.is-sending {
  transform: scale(0.94);
  opacity: 0.9; /* subtil, kein Layout-Shift */
}

/* Icon im Button stabil halten */
.dual-chatbot-send img,
.dual-chatbot-send svg {
  width: 22px;
  height: 22px;
  display: block;
  pointer-events: none; /* Klicks gehen an den Button */
}

/* ===== Mikrofon Button & Aufnahme-Timer ===== */

/* Mikrofon */
.dual-chatbot-microphone {
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: transparent !important;
  padding: 0;
  margin: 0;
  width: 44px;
  height: 44px;
  line-height: 1;
  border-radius: 999px;
  touch-action: manipulation;
}
/* Größe des Icons */
.dual-chatbot-microphone img {
  width: 20px;
  height: 20px;
  display: block;
}



/* === Timer & Aufnahme-Feedback === */
.dual-chatbot-record-timer {
  color: #e04a2f;
  margin-left: 10px;
  font-family: monospace;
  font-size: 1.08em;
  font-weight: bold;
  letter-spacing: .02em;
  user-select: none;
  min-width: 48px;
  transition: color .12s;
  display: inline-block;
  vertical-align: middle;
}

.dual-chatbot-microphone.recording {
  background: transparent !important;
  color: inherit;
  animation: pulse-mic 1.1s infinite;
  box-shadow: 0 0 0 2.5px #e04a2f44;
}

@keyframes pulse-mic {
  0%   { box-shadow: 0 0 0 2.5px #e04a2f22; }
  50%  { box-shadow: 0 0 0 10px #e04a2f33; }
  100% { box-shadow: 0 0 0 2.5px #e04a2f22; }
}

/* ===== Websuche Toggle ===== */
.dual-chatbot-websearch-toggle {
  background: #e5eefd; /* fallback */
  background: color-mix(in srgb, var(--dual-chatbot-primary) 15%, white);
  color: var(--dual-chatbot-primary);
  border: none;
  border-radius: 9px;
  padding: 7px 13px;
  font-size: 1.08rem;
  margin-right: 8px;
  margin-left: 2px;
  cursor: pointer;
  font-weight: bold;
  transition: background .14s, color .14s;
}
.dual-chatbot-websearch-toggle.active {
  background: var(--dual-chatbot-primary);
  color: #fff;
}

.dual-chatbot-recording-indicator {
  font-size: .98rem;
  color: #2a4085;
  margin-left: 10px;
  font-weight: bold;
}



/* ===== Icon Launcher ===== */
.dual-chatbot-container {
  position: fixed;
  z-index: 99999;
  right: calc(32px + env(safe-area-inset-right));
  bottom: calc(30px + env(safe-area-inset-bottom));
}
.dual-chatbot-icon {
  background: var(--dual-chatbot-icon) no-repeat center/contain;
  width: 64px;
  height: 64px;
  border: none;
  cursor: pointer;
  background-color: transparent;
  transition: transform .15s ease;
  padding: 0;
}
.dual-chatbot-icon:hover {
  transform: scale(1.05);
}

/* ===== Popup FAQ Style ===== */
.dual-chatbot-popup {
    display: flex;
    flex-direction: column;
    /* Robust, viewport-tied sizing on desktop */
    width: min(92vw, var(--dual-chatbot-mini-width, 360px));
    height: min(85vh, var(--dual-chatbot-mini-height, 520px));
    max-height: 90vh;
    position: fixed;
    right: 40px;
    bottom: 40px;
    z-index: 99999;
    background: var(--dual-surface, #fff);
    border-radius: 16px;
    box-shadow: 0 2px 16px rgba(0,0,0,0.12);
}

.dual-chatbot-chat-area {
    flex: 1 1 auto;
    overflow-y: auto;
    padding: 14px 14px 4px 14px;
    /* Center a single column like ChatGPT */
    display: grid;
    grid-template-columns: minmax(0, var(--dual-chatbot-chat-width));
    justify-content: center;
    align-content: start;
    align-items: start;
    grid-auto-rows: max-content;
    overscroll-behavior: contain;
}

/* Hide scrollbar in FAQ popup when empty */
.dual-chatbot-chat-area:empty { overflow: hidden; }

.dual-chatbot-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 1.11rem;
  font-weight: 600;
  padding: 15px 22px 13px 18px;
  border-bottom: 1px solid color-mix(in srgb, var(--dual-primary, #4e8cff) 25%, transparent);
  background: var(--dual-primary, #4e8cff);
  color: var(--dual-bg, #fff);
}
.dual-chatbot-header-title{color:var(--dual-chatbot-header-text-color, var(--dual-chatbot-text, #222));}
/* Ensure sufficient contrast in dark mode regardless of computed var */
body.dual-chatbot-theme-dark .dual-chatbot-header-title{color:#fff !important;}
body.dual-chatbot-theme-light .dual-chatbot-header-title{color:#000 !important;}
.dual-chatbot-close-btn {
  background: none;
  border: none;
  color: var(--dual-chatbot-text-muted, #888);
  font-size: 1.18rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 7px;
  transition: background .13s;
  padding: 3px 10px;
}
.dual-chatbot-close-btn:hover { background: color-mix(in srgb, var(--dual-primary, #4e8cff) 15%, #ffffff); color: var(--dual-bg, #fff); }

/* Fixiertes Eingabefeld im FAQ Popup */
.dual-chatbot-footer {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 14px;
    padding-bottom: calc(14px + env(safe-area-inset-bottom));
    background: var(--dual-surface, #fafbfc);
    border-top: 1px solid #eee;
}

.dual-chatbot-search-wrapper {
  width: 100%;
  box-sizing: border-box;
  padding: 0 16px;
  margin-top: 12px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  /* Optional: Abstand nach unten */
}

.dual-chatbot-search {
  flex: 1 1 auto;
  width: 100%;
  box-sizing: border-box;
  background: var(--dual-chatbot-sidebar-bg, #202738);
  color: var(--dual-chatbot-sidebar-text, #fff);
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  font-size: 1rem;
  transition: background 0.14s, box-shadow 0.15s;
  box-shadow: 0 1px 6px rgba(40, 80, 170, 0.07);
}

.dual-chatbot-search:focus {
  background: #2a3a59; /* dezent hellerer Fokus-Ton */
  box-shadow: 0 0 6px color-mix(in srgb, var(--dual-chatbot-primary) 45%, transparent);
}

/* removed dual-chatbot-search-icon (deprecated) */

@media (max-width: 600px) {
    .dual-chatbot-popup {
        width: 96vw;
        right: 2vw;
        left: 2vw;
        bottom: 2vw;
        min-width: unset;
    }
}

/* ===== Recolorable SVG icon masks (send/mic) ===== */
/* Base mask element */
.dual-chatbot-icon-mask {
  display: block;
  width: 22px;
  height: 22px;
  background-color: currentColor;
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-position: center;
  mask-position: center;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
  pointer-events: none;
}
/* Send icon mask uses CSS var for URL + color */
.dual-chatbot-send .dual-chatbot-icon-mask {
  -webkit-mask-image: var(--dual-chatbot-send-icon);
  mask-image: var(--dual-chatbot-send-icon);
  background-color: var(--dual-chatbot-icon-color, var(--dual-chatbot-send-icon-color, currentColor));
}
/* Microphone icon mask override size and variables */
.dual-chatbot-microphone .dual-chatbot-icon-mask {
  width: 20px;
  height: 20px;
  -webkit-mask-image: var(--dual-chatbot-mic-icon);
  mask-image: var(--dual-chatbot-mic-icon);
  background-color: var(--dual-chatbot-icon-color, var(--dual-chatbot-mic-icon-color, currentColor));
}


/* === Theme-driven variables appended (override earlier definitions) === */
:root {
  /* Admin-provided */
  --dual-chatbot-theme: auto;                 /* light | dark | auto */
  --dual-chatbot-primary: #4e8cff;            /* main accent */
  --dual-chatbot-icon-color: currentColor;    /* optional override via inline style */

  /* Light defaults (derived) */
  --dual-chatbot-surface: #ffffff;
  --dual-chatbot-surface-alt: #f7fafd;
  --dual-chatbot-text: #222222;
  --dual-chatbot-muted: #888888;

  /* Components (derived) */
  --dual-chatbot-main-bg: var(--dual-chatbot-surface);
  --dual-chatbot-sidebar-bg: color-mix(in srgb, var(--dual-chatbot-primary) 8%, #202738);
  --dual-chatbot-sidebar-text: #ffffff;
  --dual-chatbot-send-btn-bg: var(--dual-chatbot-primary);

  /* Legacy tokens mapped to derived values */
  --dual-chatbot-secondary: var(--dual-chatbot-surface-alt);
  --dual-chatbot-bot-bg: color-mix(in srgb, var(--dual-chatbot-primary) 10%, var(--dual-chatbot-surface-alt));
  --dual-chatbot-user-bg: color-mix(in srgb, var(--dual-chatbot-primary) 6%, var(--dual-chatbot-surface-alt));
  --dual-chatbot-text-muted: var(--dual-chatbot-muted);
  --dual-chatbot-new-chat-btn-bg: color-mix(in srgb, var(--dual-chatbot-primary) 12%, #e8eaf6);
}

@media (prefers-color-scheme: dark) {
  :root {
    /* Theme primary colors */
    --clr-primary-a0: #ffc23d;
    --clr-primary-a10: #ffc956;
    --clr-primary-a20: #ffcf6d;
    --clr-primary-a30: #ffd682;
    --clr-primary-a40: #ffdd97;
    --clr-primary-a50: #ffe3ac;
    /* Theme surface colors */
    --clr-surface-a0: #080808;
    --clr-surface-a10: #222222;
    --clr-surface-a20: #393939;
    --clr-surface-a30: #525252;
    --clr-surface-a40: #6c6c6c;
    --clr-surface-a50: #888888;
    /* Theme tonal surface colors */
    --clr-surface-tonal-a0: #201b12;
    --clr-surface-tonal-a10: #353028;
    --clr-surface-tonal-a20: #4b463f;
    --clr-surface-tonal-a30: #625e57;
    --clr-surface-tonal-a40: #7a7771;
    --clr-surface-tonal-a50: #93908b;

    /* Map palette to chatbot variables */
    --dual-chatbot-primary: var(--clr-primary-a0);
    --dual-chatbot-surface: var(--clr-surface-a0);
    --dual-chatbot-surface-alt: var(--clr-surface-a20);
    --dual-chatbot-text: #f5f5f5;           /* ensure readability on dark surfaces */
    --dual-chatbot-muted: var(--clr-surface-a50);
    --dual-chatbot-main-bg: var(--dual-chatbot-surface);
    --dual-chatbot-sidebar-bg: color-mix(in srgb, var(--dual-chatbot-primary) 12%, var(--clr-surface-a0));
    --dual-chatbot-sidebar-text: var(--clr-primary-a50); /* warm readable tint */
    --dual-chatbot-bot-bg: color-mix(in srgb, var(--dual-chatbot-primary) 16%, var(--dual-chatbot-surface-alt));
    --dual-chatbot-user-bg: color-mix(in srgb, var(--dual-chatbot-primary) 10%, var(--dual-chatbot-surface-alt));
    --dual-chatbot-new-chat-btn-bg: color-mix(in srgb, var(--dual-chatbot-primary) 22%, var(--clr-surface-a10));
    /* Make icon masks white in system dark mode */
    --dual-chatbot-icon-color: #ffffff;
  }
}

/* Force light/dark via body class (overrides auto) */
body.dual-chatbot-theme-light {
  --dual-chatbot-surface: #ffffff;
  --dual-chatbot-surface-alt: #f7fafd;
  --dual-chatbot-text: #222222;
  --dual-chatbot-muted: #888888;
  --dual-chatbot-main-bg: var(--dual-chatbot-surface);
  --dual-chatbot-sidebar-bg: color-mix(in srgb, var(--dual-chatbot-primary) 8%, #202738);
  --dual-chatbot-sidebar-text: #ffffff;
  --dual-chatbot-bot-bg: color-mix(in srgb, var(--dual-chatbot-primary) 10%, var(--dual-chatbot-surface-alt));
  --dual-chatbot-user-bg: color-mix(in srgb, var(--dual-chatbot-primary) 6%, var(--dual-chatbot-surface-alt));
  --dual-chatbot-new-chat-btn-bg: color-mix(in srgb, var(--dual-chatbot-primary) 12%, #e8eaf6);
  /* Icons schwarz im hellen Modus */
  --dual-chatbot-icon-color: #000000;
}
body.dual-chatbot-theme-dark {
  /* Apply the same palette mapping when dark is forced */
  --clr-primary-a0: #ffc23d;
  --clr-primary-a10: #ffc956;
  --clr-primary-a20: #ffcf6d;
  --clr-primary-a30: #ffd682;
  --clr-primary-a40: #ffdd97;
  --clr-primary-a50: #ffe3ac;
  --clr-surface-a0: #080808;
  --clr-surface-a10: #222222;
  --clr-surface-a20: #393939;
  --clr-surface-a30: #525252;
  --clr-surface-a40: #6c6c6c;
  --clr-surface-a50: #888888;
  --clr-surface-tonal-a0: #201b12;
  --clr-surface-tonal-a10: #353028;
  --clr-surface-tonal-a20: #4b463f;
  --clr-surface-tonal-a30: #625e57;
  --clr-surface-tonal-a40: #7a7771;
  --clr-surface-tonal-a50: #93908b;

  --dual-chatbot-primary: var(--clr-primary-a0);
  --dual-chatbot-surface: var(--clr-surface-a0);
  --dual-chatbot-surface-alt: var(--clr-surface-a20);
  --dual-chatbot-text: #f5f5f5;
  --dual-chatbot-muted: var(--clr-surface-a50);
  --dual-chatbot-main-bg: var(--dual-chatbot-surface);
  --dual-chatbot-sidebar-bg: color-mix(in srgb, var(--dual-chatbot-primary) 12%, var(--clr-surface-a0));
  --dual-chatbot-sidebar-text: var(--clr-primary-a50);
  --dual-chatbot-bot-bg: color-mix(in srgb, var(--dual-chatbot-primary) 16%, var(--dual-chatbot-surface-alt));
  --dual-chatbot-user-bg: color-mix(in srgb, var(--dual-chatbot-primary) 10%, var(--dual-chatbot-surface-alt));
  --dual-chatbot-new-chat-btn-bg: color-mix(in srgb, var(--dual-chatbot-primary) 22%, var(--clr-surface-a10));
  /* Ensure icon masks are white when dark is forced */
  --dual-chatbot-icon-color: #ffffff;
  /* Dark scrollbar tokens */
  --dual-chatbot-scrollbar-track: rgba(255,255,255,.08);
  --dual-chatbot-scrollbar-thumb: rgba(255,255,255,.32);
  --dual-chatbot-scrollbar-thumb-hover: rgba(255,255,255,.48);
}

/* === Simplified theme variables (single primary color) === */
:root { --your-primary-color: #4e8cff; }

/* Icon masks for header controls */
:root {
  --dual-chatbot-close-icon: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M18.3 5.71 12 12.01 5.7 5.7 4.29 7.11 10.59 13.41 4.29 19.71 5.7 21.12 12 14.83 18.3 21.12 19.71 19.71 13.41 13.41 19.71 7.11z"/></svg>');
  --dual-chatbot-collapse-icon: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M14.7 6.3 9 12l5.7 5.7 1.4-1.4L11.8 12l4.3-4.3z"/></svg>');
  --dual-chatbot-expand-icon: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M9.3 6.3 15 12l-5.7 5.7-1.4-1.4L12.2 12 7.9 7.7z"/></svg>');
  --dual-chatbot-cancel-icon: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M18.3 5.71 12 12.01 5.7 5.7 4.29 7.11 10.59 13.41 4.29 19.71 5.7 21.12 12 14.83 18.3 21.12 19.71 19.71 13.41 13.41 19.71 7.11z"/></svg>');
  --dual-chatbot-check-icon: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M9 16.2 4.8 12 3.4 13.4 9 19 21 7 19.6 5.6z"/></svg>');
}

/* Unified header control buttons using CSS masks */
.dual-chatbot-close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--dual-chatbot-text, var(--dual-text, #222));
  cursor: pointer;
  border-radius: 6px;
  transition: background .15s ease;
}
.dual-chatbot-close::before {
  content: '';
  width: 20px;
  height: 20px;
  background-color: currentColor;
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
  -webkit-mask-position: center;
  mask-position: center;
}
.dual-chatbot-close::before { -webkit-mask-image: var(--dual-chatbot-close-icon); mask-image: var(--dual-chatbot-close-icon); }
.dual-chatbot-close:hover { background: color-mix(in srgb, var(--dual-primary, #4e8cff) 20%, transparent); }

/* Sidebar toggle is positioned in main header via JavaScript */
.dual-chatbot-sidebar-toggle:focus-visible {
  outline: 3px solid var(--dcb-focus);
  outline-offset: 2px;
}
.dual-chatbot-sidebar-toggle:hover {
  box-shadow: 0 4px 14px rgba(0,0,0,.18);
}
.dual-chatbot-sidebar-toggle-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  transition: transform .25s ease;
}
.dual-chatbot-sidebar-toggle-icon svg {
  width: 100%;
  height: 100%;
}
.dual-chatbot-sidebar-toggle.is-collapsed .dual-chatbot-sidebar-toggle-icon {
  transform: scaleX(-1);
}
/* Sidebar toggle positioning handled via main header */
/* Desktop minimized state handled in @media (min-width: 801px) */
/* Mobile minimized state handled in @media (max-width: 800px) */
/* Icon flip already handled above at line ~934 */
.dual-chatbot-sidebar.is-collapsed {
  width: 56px !important;
  flex: 0 0 56px;
  min-width: 56px;
}
.dual-chatbot-sidebar.is-collapsed .dual-chatbot-profile,
.dual-chatbot-sidebar.is-collapsed .dual-chatbot-sidebar-header,
.dual-chatbot-sidebar.is-collapsed .dual-chatbot-search-wrapper,
.dual-chatbot-sidebar.is-collapsed .dual-chatbot-new-chat-btn,
.dual-chatbot-sidebar.is-collapsed .dual-chatbot-sidebar-list { display: none !important; }

/* ===== Desktop: Push Layout ===== */
@media (min-width: 801px) {
  /* Desktop uses push layout with flex */
  .dual-chatbot-fullscreen {
    display: flex;
  }
  
  /* Sidebar with transition on width for push effect */
  .dual-chatbot-sidebar {
    width: var(--dual-chatbot-sidebar-width-desktop);
    flex: 0 0 var(--dual-chatbot-sidebar-width-desktop);
    min-width: var(--dual-chatbot-sidebar-width-desktop);
    transition: width 250ms ease;
    overflow: auto;
  }
  
  /* Main area takes remaining space */
  .dual-chatbot-main {
    flex: 1 1 auto;
    min-width: 0;
    padding-left: 20px; /* prevent chat from sticking to sidebar */
  }
  
  /* When minimized, sidebar collapses to 0 width */
  .dual-chatbot-fullscreen.dual-chatbot-minimized .dual-chatbot-sidebar {
    width: 0 !important;
    flex: 0 0 0 !important;
    min-width: 0 !important;
    overflow: hidden !important;
    border-right: 0 !important;
    display: flex; /* keep flex for smooth animation */
  }
  .dual-chatbot-minimized .dual-chatbot-sidebar * {
    pointer-events: none; /* keine "toten" Klickflächen */
  }
  
  /* Disable backdrop on desktop */
  .dual-chatbot-backdrop {
    display: none !important;
    pointer-events: none !important;
  }
}

/* ===== Mobile: Advisor Sidebar Slide-Over with Backdrop ===== */
@media (max-width: 800px) {
  /* Define slide-over width and safe-area variables on the fullscreen container */
  .dual-chatbot-fullscreen {
    --sidebar-slide-width: min(85vw, 320px);
  }

  /* Sidebar becomes an overlay that slides in from the left */
  .dual-chatbot-fullscreen .dual-chatbot-sidebar {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: var(--sidebar-slide-width);
    max-width: 320px;
    flex: none;
    min-width: 0;
    z-index: 3; /* above main chat */
    transform: translateX(0);
    transition: transform .25s ease;
    /* Safe areas (esp. landscape with notches) */
    padding-left: calc(env(safe-area-inset-left, 0px) + 0px);
    padding-right: calc(env(safe-area-inset-right, 0px) + 0px);
    padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 0px);
  }

  /* When minimized, move the sidebar completely off-canvas to the left */
  .dual-chatbot-fullscreen.dual-chatbot-minimized .dual-chatbot-sidebar {
    display: block; /* override desktop hidden state on mobile */
    width: var(--sidebar-slide-width); /* keep constant width for slide in/out */
    transform: translateX(calc(-100% - env(safe-area-inset-left, 0px)));
  }

  /* Mobile inherits header toggle positioning from desktop */

  /* Backdrop behind the slide-over; only interactive when sidebar is open */
  .dual-chatbot-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.40);
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s ease;
    z-index: 2; /* below sidebar, above main chat */
  }
  .dual-chatbot-fullscreen:not(.dual-chatbot-minimized) .dual-chatbot-backdrop {
    opacity: 1;
    pointer-events: auto;
  }
}

/* Light theme */
body.dual-chatbot-theme-light {
  --dual-primary: var(--your-primary-color);
  --dual-bg: #ffffff;
  --dual-text: #000000;
  --dual-surface: #f7f7f7;

  /* map legacy tokens to simplified ones */
  --dual-chatbot-primary: var(--dual-primary);
  --dual-chatbot-main-bg: var(--dual-surface);
  --dual-chatbot-secondary: var(--dual-surface);
  --dual-chatbot-text: var(--dual-text);
  --dual-chatbot-text-muted: #666666;
  --dual-chatbot-sidebar-bg: color-mix(in srgb, var(--dual-primary) 8%, #202738);
  --dual-chatbot-sidebar-text: #ffffff;
  /* Icons schwarz im hellen Modus */
  --dual-chatbot-icon-color: #000000;
}

/* Dark theme */
body.dual-chatbot-theme-dark {
  --dual-primary: var(--your-primary-color);
  --dual-bg: #080808;
  --dual-text: #ffffff;
  --dual-surface: #222222;

  /* map legacy tokens */
  --dual-chatbot-primary: var(--dual-primary);
  --dual-chatbot-main-bg: var(--dual-surface);
  --dual-chatbot-secondary: #2a2a2a;
  --dual-chatbot-text: var(--dual-text);
  --dual-chatbot-text-muted: #bdbdbd;
  --dual-chatbot-sidebar-bg: #1F1F1F; /* requested dark sidebar color */
  --dual-chatbot-sidebar-text: #ffffff;
  /* Ensure icon masks are white in this dark profile too */
  --dual-chatbot-icon-color: #ffffff;
}

/* Explicit fallback: in dark theme, also set button color to white
   so currentColor-based masks render white regardless of variable precedence */
body.dual-chatbot-theme-dark .dual-chatbot-send,
body.dual-chatbot-theme-dark .dual-chatbot-microphone {
  color: #ffffff;
}

/* Light theme explicit: ensure currentColor is black for icon masks */
body.dual-chatbot-theme-light .dual-chatbot-send,
body.dual-chatbot-theme-light .dual-chatbot-microphone {
  color: #000000;
}



.dual-chatbot-microphone:focus-visible{ outline:2px solid var(--dcb-focus); outline-offset:2px; }

.dual-chatbot-send {
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border: none;
  padding: 0;
  background: transparent !important;
  cursor: pointer;
  transition: transform 120ms ease, opacity 120ms ease;
  will-change: transform;
  box-shadow: none !important;
  margin: 0;
  touch-action: manipulation;
}
.dual-chatbot-send:hover { background: transparent !important; box-shadow: none !important; opacity: 1; }
.dual-chatbot-send:active { transform: scale(0.96); }
.dual-chatbot-send.is-sending { transform: scale(0.94); opacity: 0.9; }




.dual-chatbot-record-timer { display:none !important; visibility:hidden; width:0; height:0; margin:0; padding:0; border:0; }


/* === Dark theme: sidebar toggle refinements ===
   Provide higher contrast arrow + stronger depth */
body.dual-chatbot-theme-dark .dual-chatbot-sidebar-toggle {
  --dual-chatbot-sidebar-toggle-icon-color: #0b1524;
  border: 1px solid rgba(0,0,0,.18);
  box-shadow: 0 3px 16px rgba(0,0,0,.35);
}
body.dual-chatbot-theme-dark .dual-chatbot-sidebar-toggle:hover {
  box-shadow: 0 5px 20px rgba(0,0,0,.4);
}
body.dual-chatbot-theme-dark .dual-chatbot-sidebar-toggle:focus-visible {
  outline-color: color-mix(in srgb, var(--dual-chatbot-primary, #ffc23d) 60%, transparent);
}

/* === Recording action UI (preview + cancel + accept) === */
.dual-chatbot-record-actions{
  display: none;
  align-items: center;
  gap: 8px;
  margin-left: 8px;
}
.dual-chatbot-record-preview{
  max-width: 320px;
  display: none;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: .95rem;
  line-height: 1.2;
  padding: 6px 10px;
  border-radius: 10px;
  background: var(--dual-chatbot-secondary);
  color: var(--dual-chatbot-text, #222);
  border: 1px solid rgba(0,0,0,.08);
}
.dual-chatbot-record-btn{
  width: 32px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background .15s ease;
}
.dual-chatbot-record-btn:hover{ background: color-mix(in srgb, var(--dual-chatbot-primary, #4e8cff) 18%, transparent); }
.dual-chatbot-record-btn::before{
  content: '';
  width: 18px;
  height: 18px;
  background-color: currentColor;
  -webkit-mask-size: contain; mask-size: contain;
  -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat;
  -webkit-mask-position: center; mask-position: center;
}
.dual-chatbot-record-cancel{ color:#e04a2f; }
.dual-chatbot-record-cancel::before{ -webkit-mask-image: var(--dual-chatbot-cancel-icon); mask-image: var(--dual-chatbot-cancel-icon); }
.dual-chatbot-record-accept{ color:#2fbf71; }
.dual-chatbot-record-accept::before{ -webkit-mask-image: var(--dual-chatbot-check-icon); mask-image: var(--dual-chatbot-check-icon); }

/* Dark theme preview chip tuning */
body.dual-chatbot-theme-dark .dual-chatbot-record-preview{
  background: color-mix(in srgb, #ffffff 6%, var(--dual-chatbot-secondary, #2a2a2a));
  border-color: rgba(255,255,255,.08);
  color: var(--dual-chatbot-text, #f5f5f5);
}

/* Ensure readable input text in both themes */
.dual-chatbot-input { color: var(--dual-chatbot-text, var(--dual-text, #222)); caret-color: currentColor; }
.dual-chatbot-input-wrapper .dual-chatbot-input { color: var(--dual-chatbot-text, var(--dual-text, #222)); caret-color: currentColor; }
body.dual-chatbot-theme-dark .dual-chatbot-input,
body.dual-chatbot-theme-dark .dual-chatbot-input-wrapper .dual-chatbot-input { color: #ffffff !important; }
body.dual-chatbot-theme-dark .dual-chatbot-input::placeholder { color: #cfcfcf; opacity: .8; }

/* Match input typography to chat/sidebar */
.dual-chatbot-input,
.dual-chatbot-input-wrapper .dual-chatbot-input{
  font-family: inherit;
  font-size: 1.04rem; /* align with .dual-chatbot-message */
}

/* === ChatGPT-like Input Pill === */
.dual-chatbot-input-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  max-width: var(--dual-chatbot-chat-width, 720px);
  margin: 0 auto;
  padding: 6px 8px;
  border-radius: 999px; /* full pill */
  background: color-mix(in srgb, var(--dual-chatbot-secondary, #f5f6fa) 70%, var(--dual-chatbot-main-bg, #fff));
  border: 1px solid rgba(0,0,0,.12);
  box-shadow: 0 2px 12px rgba(0,0,0,.08);
  transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
}
.dual-chatbot-input-wrapper:focus-within{
  border-color: color-mix(in srgb, var(--dual-chatbot-primary, #4e8cff) 60%, transparent);
  box-shadow: 0 4px 16px rgba(20,40,80,.18);
}
body.dual-chatbot-theme-dark .dual-chatbot-input-wrapper{
  background: color-mix(in srgb, #ffffff 6%, var(--dual-chatbot-secondary, #222));
  border-color: rgba(255,255,255,.08);
  box-shadow: 0 2px 12px rgba(0,0,0,.45);
}
body.dual-chatbot-theme-dark .dual-chatbot-input-wrapper:focus-within{
  border-color: color-mix(in srgb, var(--dual-chatbot-primary, #ffc23d) 60%, transparent);
  box-shadow: 0 6px 18px rgba(0,0,0,.55);
}

/* Input inside pill: flat, transparent */
.dual-chatbot-input-wrapper .dual-chatbot-input{
  flex: 1 1 auto;
  height: 44px;
  min-height: 44px;
  /* Allow multiline growth up to ~220px, then scroll internally */
  max-height: 220px;
  padding: 10px 12px;
  border: none;
  background: transparent;
  outline: none;
  box-shadow: none;
}
.dual-chatbot-input-wrapper .dual-chatbot-input:focus{ border: none; }
.dual-chatbot-input::placeholder{ color: color-mix(in srgb, var(--dual-chatbot-text, #222) 50%, transparent); opacity: .7; }

/* Icons in pill: compact size */
.dual-chatbot-input-wrapper .dual-chatbot-microphone,
.dual-chatbot-input-wrapper .dual-chatbot-send{
  width: 36px;
  height: 36px;
}

/* Send icon without colored circle background */
.dual-chatbot-input-wrapper .dual-chatbot-send{ position: relative; color: inherit; }
.dual-chatbot-input-wrapper .dual-chatbot-send::after{ content: none !important; display: none !important; }
.dual-chatbot-input-wrapper .dual-chatbot-send .dual-chatbot-icon-mask{ position: relative; z-index: 1; }
/* Light theme: keep icon dark */
body.dual-chatbot-theme-light .dual-chatbot-input-wrapper .dual-chatbot-send{ color: #000; }

/* Inline editor inside a message (user edit) */
.dual-inline-edit{
  width:100%;
  max-width:var(--dual-chatbot-chat-width, 760px);
  margin:6px 0;
  /* Edit field as a clean card, not a full pill */
  border-radius: 16px;
  padding: 10px 14px; /* slightly more padding than default wrapper */
  position: relative; /* allow top-right X placement */
  padding-right: 52px; /* reserve space for cancel icon hit-area */
  transition: max-width .22s ease, padding .22s ease;
}
.dual-chatbot-user.is-editing .dual-inline-edit{
  /* make edit bubble a bit wider than normal (user bubble ~70%) */
  max-width: min(var(--dual-chatbot-chat-width, 760px), calc(var(--dual-chatbot-user-bubble-max, 70%) + 10%));
  /* add a touch more inner space while editing */
  padding-top: 12px;
  padding-bottom: 12px;
}
@media (max-width: 680px){
  /* on small screens do not force wider than the column */
  .dual-chatbot-user.is-editing .dual-inline-edit{
    max-width: var(--dual-chatbot-chat-width, 760px);
  }
}
/* Icon-only cancel inside edit wrapper */
.msg-edit-cancel{
  position: absolute;
  top: 6px;
  right: 6px;
  width: 32px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 8px;
  /* Use theme icon color token: white in dark, black in light */
  color: var(--dual-chatbot-icon-color, currentColor);
  cursor: pointer;
  z-index: 3;
  transition: background .15s ease, transform .12s ease, opacity .12s ease;
}
.msg-edit-cancel::before{
  content: '';
  width: 18px;
  height: 18px;
  background-color: currentColor;
  -webkit-mask-image: var(--dual-chatbot-cancel-icon);
  mask-image: var(--dual-chatbot-cancel-icon);
  -webkit-mask-size: contain; mask-size: contain;
  -webkit-mask-position: center; mask-position: center;
  -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat;
}
.msg-edit-cancel:hover{ opacity: 1; background: rgba(0,0,0,.06); }
body.dual-chatbot-theme-dark .msg-edit-cancel:hover{ background: rgba(255,255,255,.08); }
.msg-edit-cancel:active{ transform: scale(0.96); }
.msg-edit-cancel:focus-visible{ outline: 2px solid var(--dual-chatbot-primary, #4e8cff); outline-offset: 2px; }
/* Tooltip on cancel icon */
.msg-edit-cancel[data-tip]:hover::after{
  content: attr(data-tip);
  position:absolute; top: calc(100% + 6px); right: 0;
  background: rgba(0,0,0,.8); color:#fff; padding:4px 6px; border-radius:6px; font-size:.75rem; white-space:nowrap; pointer-events:none;
}
body.dual-chatbot-theme-dark .msg-edit-cancel[data-tip]:hover::after{ background: rgba(255,255,255,.12); color:#fff; }
.dual-inline-edit:focus-within{
  /* Make focus ring a touch clearer in edit mode */
  box-shadow: 0 5px 18px rgba(20,40,80,.20);
}
.dual-chatbot-cancel{ background: transparent; border: none; color: inherit; opacity:.75; padding: 6px 10px; border-radius:8px; cursor:pointer; }
.dual-chatbot-cancel:hover{ opacity: 1; background: rgba(0,0,0,.06); }
body.dual-chatbot-theme-dark .dual-chatbot-cancel:hover{ background: rgba(255,255,255,.08); }

/* Footer area subtle like ChatGPT */
.dual-chatbot-main-footer{ background: transparent; border-top: none; padding: 16px; padding-bottom: calc(16px + env(safe-area-inset-bottom)); }
/* Compact icon-only sidebar toggle */
.dual-chatbot-sidebar-toggle {
  display: inline-grid;
  place-items: center;
  width: 28px;
  height: 28px;
  padding: 0;
  background: transparent;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
.dual-chatbot-sidebar-toggle:hover { background: rgba(0,0,0,.06); }
.dual-chatbot-sidebar-toggle:focus-visible { outline: 2px solid var(--dcb-focus); outline-offset: 2px; }

/* Sidebar open handle (visible when minimized) */
.dual-chatbot-sidebar-handle{position:absolute;top:12px;left:0;transform:translateX(-50%);z-index:30;width:28px;height:28px;border-radius:999px;border:1px solid rgba(0,0,0,.15);background:var(--dual-chatbot-main-bg);display:none;align-items:center;justify-content:center;cursor:pointer}
.dual-chatbot-sidebar-handle::before{content:'';width:18px;height:18px;background:currentColor;-webkit-mask-image:var(--dual-chatbot-expand-icon);mask-image:var(--dual-chatbot-expand-icon);-webkit-mask-size:contain;mask-size:contain;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-position:center;mask-position:center}
.dual-chatbot-fullscreen.dual-chatbot-minimized .dual-chatbot-sidebar-handle{display:flex}

/* Final layout overrides to ensure spacing and toggle alignment */
.dual-chatbot-sidebar-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
.dual-chatbot-sidebar-header .dual-chatbot-sidebar-toggle{margin-left:auto}

/* Final overrides: ensure header order and spacing */
.dual-chatbot-sidebar-header{ display:flex; align-items:center; gap:8px; flex-direction:row; }
.dual-chatbot-sidebar-title{ flex:0 0 auto; min-width:auto; }
.dual-chatbot-sidebar-header .dual-chatbot-sidebar-toggle{ margin-left:0; }

/* (moved to file end) */

/* Sidebar header layout overrides */
.dual-chatbot-sidebar-header { display: flex; align-items: center; gap: 8px; justify-content: space-between; }

/* Ensure same compact style when toggle is placed in the sidebar header */
.dual-chatbot-sidebar-header .dual-chatbot-sidebar-toggle {
  width: 28px;
  height: 28px;
  background: transparent;
  border: none;
  box-shadow: none;
  color: inherit;
}

/* Dark theme: keep icon-only look (no extra borders/shadows) */
body.dual-chatbot-theme-dark .dual-chatbot-sidebar-toggle {
  border: none;
  box-shadow: none;
  background: transparent;
}

/* Sidebar toggle mask mapping */
.dual-chatbot-sidebar-toggle .dual-chatbot-icon-mask{
  width: 22px;
  height: 22px;
  background: currentColor;
  -webkit-mask: var(--dual-chatbot-collapse-icon) no-repeat center/22px 22px;
  mask: var(--dual-chatbot-collapse-icon) no-repeat center/22px 22px;
}
.dual-chatbot-fullscreen.dual-chatbot-minimized .dual-chatbot-sidebar-toggle .dual-chatbot-icon-mask{
  -webkit-mask: var(--dual-chatbot-expand-icon) no-repeat center/22px 22px;
  mask: var(--dual-chatbot-expand-icon) no-repeat center/22px 22px;
}

/* Search toggle mask mapping */
.dual-chatbot-search-toggle .dual-chatbot-icon-mask{
  width: 22px;
  height: 22px;
  background-color: currentColor;
  -webkit-mask-image: var(--dual-icon-search);
  mask-image: var(--dual-icon-search);
  -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat;
  -webkit-mask-position: center; mask-position: center;
  -webkit-mask-size: contain; mask-size: contain;
}
/* Unified icon-only button sizing */
.dual-chatbot-rename-btn,
.dual-chatbot-delete-btn,
.dual-chatbot-search-toggle,
.dual-chatbot-sidebar-toggle {
  display: inline-grid;
  place-items: center;
  width: 28px;
  height: 28px;
  padding: 0;
  background: transparent;
  border: 0;
  border-radius: 6px;
  cursor: pointer;
}

.dual-chatbot-rename-btn:hover,
.dual-chatbot-delete-btn:hover,
.dual-chatbot-search-toggle:hover,
.dual-chatbot-sidebar-toggle:hover { background: rgba(0,0,0,.06); }

.dual-chatbot-rename-btn:focus-visible,
.dual-chatbot-delete-btn:focus-visible,
.dual-chatbot-search-toggle:focus-visible,
.dual-chatbot-sidebar-toggle:focus-visible { outline: 2px solid var(--dcb-focus); outline-offset: 2px; }
